<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esercizi Pratici: La Struttura Causativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* bg-slate-200 */
        }
        .key-rule {
            background-color: #eef2ff; /* bg-indigo-50 */
            color: #3730a3; /* text-indigo-800 */
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        .student-response {
            background-color: #fffbeb; /* bg-amber-50 */
            border-left: 4px solid #f59e0b; /* border-amber-500 */
            padding: 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        h1, h2, h3, h4 {
            font-weight: 700;
        }
        code, .font-mono {
            font-family: 'Source Code Pro', monospace;
        }
        /* Custom styles for tabs and feedback */
        .tab-btn {
            color: #64748b; /* text-slate-500 */
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease-in-out;
        }
        .tab-btn:hover {
            color: #475569; /* text-slate-600 */
        }
        .tab-active {
            color: #4f46e5; /* text-indigo-600 */
            border-color: #4f46e5; /* border-indigo-600 */
            font-weight: 600;
        }
        .tab-inactive {
            color: #64748b; /* text-slate-500 */
        }
        .feedback-correct {
            border-color: #10b981; /* green-500 */
            background-color: #ecfdf5; /* green-50 */
        }
        .feedback-incorrect {
            border-color: #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }
        .explanation {
            color: #475569; /* text-slate-600 */
        }
    </style>
</head>
<body class="text-slate-700">

    <div class="container mx-auto p-6 md:p-10 max-w-7xl">

        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
            <header class="p-6">
                <h1 class="text-3xl font-bold text-slate-900">Esercizi Pratici: La Struttura Causativa</h1>
                <p class="text-lg text-slate-600">Metti in pratica la teoria con esercizi mirati.</p>
            </header>
            <div class="p-6 border-t border-slate-200 bg-slate-50 text-sm text-slate-600 space-y-3">
                <h3 class="font-semibold text-slate-800">Come usare questa pagina:</h3>
                <ul class="list-disc list-inside space-y-1">
                    <li><strong>Salvataggio Automatico:</strong> I tuoi progressi (risposte e note) vengono salvati costantemente.</li>
                    <li><strong>Pulsanti di Navigazione:</strong> Utilizza i pulsanti sulla barra degli strumenti per navigare tra le schede, salvare e caricare i progressi o ripristinare l'esercizio.</li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- Tabs -->
            <div class="border-b border-slate-200">
                <nav class="flex space-x-6 px-6" aria-label="Tabs">
                    <button id="tab-btn-1" data-tab="1" class="tab-btn py-4 px-1 text-sm font-medium tab-active">Fase 1: Comprensione</button>
                    <button id="tab-btn-2" data-tab="2" class="tab-btn py-4 px-1 text-sm font-medium tab-inactive">Fase 2: Riconoscimento</button>
                    <button id="tab-btn-3" data-tab="3" class="tab-btn py-4 px-1 text-sm font-medium tab-inactive">Fase 3: Produzione</button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="p-6 md:p-8">
                <div id="tab-content-1" class="tab-content"></div>
                <div id="tab-content-2" class="tab-content hidden"></div>
                <div id="tab-content-3" class="tab-content hidden"></div>
            </div>
        </div>
    </div>

    <script id="exercise-data" type="application/json">
        {
            "fase1": [
                { "question": "La frase 'I cut my hair' significa la stessa cosa di 'I had my hair cut'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. 'I cut my hair' significa che l'ho tagliato io stesso. 'I had my hair cut' significa che un parrucchiere l'ha fatto per me." },
                { "question": "La frase 'She is having her car serviced' significa che sta organizzando affinché un meccanico controlli la sua auto.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Lei non sta facendo il servizio, lo sta facendo fare." },
                { "question": "In 'I got the report printed', il verbo 'get' è più formale di 'have'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. 'Have' è generalmente considerato più formale di 'get' in questa struttura." },
                { "question": "La frase 'He had his assistant call the client' è un esempio di causativo attivo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Specifica chi compie l'azione (his assistant) e usa la struttura 'have + persona + verbo base'." },
                { "question": "La struttura 'get someone to do something' si usa per dare un ordine perentorio.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Si usa più per 'convincere' o 'persuadere' qualcuno a fare qualcosa." },
                { "question": "'I had my wallet stolen' è un uso corretto della struttura causativa per un evento negativo e non pianificato.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. La struttura si usa anche per descrivere cose che ci accadono, non solo servizi che richiediamo." },
                { "question": "La frase 'The boss made us work late' ha lo stesso significato di 'The boss had us work late'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Sebbene entrambe le frasi indichino che il capo ha causato il lavoro straordinario, 'made' implica costrizione o obbligo, mentre 'had' indica un'istruzione o un incarico dato. Non hanno esattamente lo stesso significato." },
                { "question": "Nella frase 'I had the technician fix the computer', 'fix' è un participio passato.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. È un verbo alla forma base. La struttura è 'have + persona + verbo base'." },
                { "question": "Per esprimere persuasione, è più comune usare 'I got my friend to help me' piuttosto che 'I had my friend help me'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. 'Get someone to do' implica persuasione, mentre 'have someone do' è più un'istruzione." },
                { "question": "La frase 'We are having a new kitchen installed' è al tempo presente semplice.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. È al Present Continuous, per descrivere un'azione in corso in questo periodo." },
                { "question": "'I'll have my secretary to book a flight' è grammaticalmente corretto.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Dopo 'have + persona', si usa il verbo base senza 'to'. Corretto: '...have my secretary book...'." },
                { "question": "La struttura causativa si può usare solo per i servizi a pagamento.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Si può usare per qualsiasi azione che si fa fare a qualcun altro, anche gratuitamente (es. 'I had my brother check my essay')." },
                { "question": "'Get your car washed' è un modo per dare un consiglio o un suggerimento forte.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Usato all'imperativo, ha una funzione simile a un suggerimento o un ordine." },
                { "question": "Nella frase 'She got the package delivered', non sappiamo chi ha consegnato il pacco.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Il causativo passivo si concentra sull'azione ricevuta, non su chi l'ha eseguita." },
                { "question": "La frase 'He had his car being repaired' è una forma comune e corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. La forma corretta per un'azione in corso al passato è 'He was having his car repaired'. 'He had his car repaired' è corretto per un'azione completata nel passato. 'being' non si usa in questo modo con 'had' nel causativo passivo." },
                { "question": "Il causativo con 'make' ('make someone do something') implica sempre una scelta libera da parte di chi agisce.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. 'Make' implica obbligo o costrizione, non una scelta libera." },
                { "question": "Posso dire 'I will have my house to be painted'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. La struttura è 'have + oggetto + participio passato'. Corretto: '...have my house painted'." },
                { "question": "La domanda 'Did you have your hair cut?' chiede se hai tagliato i capelli da solo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Chiede se sei andato dal parrucchiere, cioè se hai 'fatto tagliare' i capelli." },
                { "question": "La frase 'I must get this suit cleaned' esprime una necessità.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. La combinazione del modale 'must' con il causativo 'get' esprime un obbligo o una forte necessità." },
                { "question": "'I had him to leave' è una costruzione corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Con 'have' si usa il verbo base: 'I had him leave'. Con 'get' si userebbe 'to': 'I got him to leave'." },
                { "question": "La frase 'I got my car to be washed' è una forma passiva corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. La forma passiva corretta è 'I got my car washed'. Nel causativo passivo con 'get', si usa il participio passato direttamente dopo l'oggetto, non l'infinito 'to be'." },
                { "question": "La frase 'The film made me cry' è un esempio di causativo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. 'Make' è un verbo causativo che indica che qualcosa ha causato una reazione." },
                { "question": "'Let me go' significa 'permettimi di andare'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. 'Let' è un verbo causativo che esprime permesso." },
                { "question": "Nella frase 'I had my report checked', 'checked' è un aggettivo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. È il participio passato del verbo 'check'." },
                { "question": "La frase 'She had her assistant to type the letter' è corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. La struttura è 'have + persona + verbo base (type)'." },
                { "question": "'We got the problem to solve' è una frase corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. La frase corretta sarebbe 'We got the problem solved' (passivo) o 'We got someone to solve the problem' (attivo)." },
                { "question": "La frase 'I will have the package delivered tomorrow' è al futuro.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Usa 'will have' per formare il futuro causativo." },
                { "question": "'I'm having a party organized' significa che sto organizzando la festa da solo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Significa che qualcun altro (un organizzatore di eventi, amici) la sta organizzando per me." },
                { "question": "La frase 'He got his brother do his homework' è corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Con 'get' si usa l'infinito con 'to': '...got his brother to do...'" },
                { "question": "'I had my phone repaired' e 'My phone was repaired' hanno esattamente lo stesso significato.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. 'I had my phone repaired' enfatizza che ho organizzato io la riparazione. 'My phone was repaired' è una semplice constatazione passiva." },
                { "question": "'Make' e 'let' sono seguiti dalla forma base del verbo, senza 'to'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Esempi: 'make him go', 'let her see'." },
                { "question": "La forma 'have + oggetto + participio passato' può descrivere un incidente.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Esempio: 'She had her leg broken in the accident'." },
                { "question": "La frase 'I'll get it done' è una promessa di fare qualcosa personalmente.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. È una promessa di assicurarsi che l'azione venga completata, probabilmente da qualcun altro." },
                { "question": "Nella struttura attiva, 'get' è più comune di 'have' per dare ordini a subordinati.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. 'Have' (es. 'I had my assistant do it') è più comune per dare istruzioni o ordini in un contesto professionale." },
                { "question": "La frase 'I was made to apologize' è la forma passiva di 'They made me apologize'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Nota che nella forma passiva di 'make', si aggiunge 'to' prima del verbo." },
                { "question": "La frase 'I had my house burgled' è un modo corretto per dire che i ladri sono entrati in casa.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. È un uso comune del causativo passivo per eventi negativi." },
                { "question": "La frase 'I got my hair cutting' è una forma corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Si usa il participio passato: 'I got my hair cut'." },
                { "question": "La frase 'I'll have the chef to prepare a special meal' è corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. La struttura è 'have + persona + verbo base': '...have the chef prepare...'" },
                { "question": "Il causativo si usa solo con i verbi 'have', 'get', e 'make'.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Anche 'let' e 'help' sono considerati verbi causativi ('let me know', 'help me (to) finish')." },
                { "question": "Nella frase 'I helped my dad (to) wash the car', il 'to' è opzionale.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Con il verbo 'help', l'infinito che segue può essere usato con o senza 'to'." },
                { "question": "La frase 'I'm going to have my car wash' è corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Manca il participio passato. Corretto: '...have my car washed'." },
                { "question": "'He had his license suspended' significa che la polizia gli ha sospeso la patente.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. È un uso passivo per descrivere un'azione subita." },
                { "question": "La frase 'She got her friend buy the tickets' è corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Con 'get' si usa 'to': '...got her friend to buy...'" },
                { "question": "Un insegnante che dice 'I'll have you all speaking English' sta usando un causativo attivo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. Significa 'Farò in modo che tutti voi parlino inglese'." },
                { "question": "La frase 'I had a feeling that something was wrong' è un esempio di causativo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Qui 'had' è il verbo principale con il significato di 'avere' o 'provare'." },
                { "question": "La frase 'I had my assistant work on the report' è un esempio di causativo passivo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. È un esempio di causativo attivo perché specifica chi compie l'azione ('my assistant')." },
                { "question": "La frase 'I got the job' è un esempio di causativo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. Qui 'got' significa 'ottenere'. Non c'è un'azione fatta fare a qualcun altro." },
                { "question": "La frase 'We had the police investigate the issue' è corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "A", "explanation": "Corretto. È un causativo attivo che usa la struttura 'have + persona/ente + verbo base'." },
                { "question": "La frase 'I let my car to be repaired' è una forma corretta.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. 'Let' non si usa in questo modo. Si direbbe 'I had my car repaired' o 'I let the mechanic repair my car'." },
                { "question": "La frase 'I got myself into trouble' è un esempio di causativo.", "type": "mc", "options": ["Vero", "Falso"], "answer": "B", "explanation": "Falso. È una frase riflessiva idiomatica, non un causativo nel senso di 'far fare qualcosa'." }
            ],
            "fase2": [
                { "question": "I don't have time to do my own laundry, so I ______.", "options": ["get done", "get it done", "do it", "make it do"], "answer": "B", "explanation": "Risposta: B. La struttura corretta è 'get + oggetto (it) + participio passato (done)'." },
                { "question": "Before the presentation, the CEO had her assistant ______ the final figures.", "options": ["to check", "checking", "check", "checked"], "answer": "C", "explanation": "Risposta: C. La struttura del causativo attivo con 'have' è 'have + persona + verbo base'." },
                { "question": "This is a very important document. We must ______ it translated by a professional.", "options": ["have", "do", "get to", "make"], "answer": "A", "explanation": "Risposta: A. La struttura è 'have + oggetto + participio passato'." },
                { "question": "It was difficult to convince him, but I finally ______ him to agree.", "options": ["had", "made", "got", "persuaded"], "answer": "C", "explanation": "Risposta: C. La struttura per 'convincere/persuadere' è 'get + persona + infinito con to'." },
                { "question": "If you don't understand the contract, you should ______ a lawyer look at it.", "options": ["get", "make", "have", "ask"], "answer": "C", "explanation": "Risposta: C. Si usa 'have' per dare un'istruzione o un incarico a un professionista. 'Have a lawyer look'." },
                { "question": "The roof is leaking. We need to ______ repaired before the winter.", "options": ["have it", "it have", "get it to be", "have it get"], "answer": "A", "explanation": "Risposta: A. La struttura è '(to) have + oggetto (it) + participio passato (repaired)'." },
                { "question": "She didn't want to go, but her friends ______ her come to the party.", "options": ["got", "made", "had", "let"], "answer": "B", "explanation": "Risposta: B. 'Made someone do something' significa 'costringere' o 'forzare'. 'Got' richiederebbe 'to come'." },
                { "question": "I'm going to the dentist to ______ my teeth checked.", "options": ["get", "make", "do", "let"], "answer": "A", "explanation": "Risposta: A. La struttura è 'get/have + oggetto + participio passato'." },
                { "question": "The director ______ the marketing team create a new campaign.", "options": ["got", "made", "let", "had"], "answer": "D", "explanation": "Risposta: D. 'Had' implica un'istruzione o un incarico. 'Got' richiederebbe 'to create'." },
                { "question": "My computer wasn't working, so I ______ a specialist to fix it.", "options": ["had", "got", "made", "fixed"], "answer": "B", "explanation": "Risposta: B. 'Got' è usato per persuadere o incaricare qualcuno, e richiede la forma 'get + persona + to + verbo'." },
                { "question": "We had our house ______ last year.", "options": ["renovate", "renovating", "renovated", "to renovate"], "answer": "C", "explanation": "Risposta: C. Questa è la forma passiva: 'have + oggetto + participio passato'." },
                { "question": "He's very persuasive. He can ______ anyone to do anything.", "options": ["have", "make", "get", "let"], "answer": "C", "explanation": "Risposta: C. 'Get someone to do something' è la struttura specifica per la persuasione." },
                { "question": "The teacher ______ the students write an extra essay.", "options": ["had", "got", "let", "allowed"], "answer": "A", "explanation": "Risposta: A. 'Had' è usato per dare un'istruzione o un compito assegnato. 'Got' richiederebbe 'to write'." },
                { "question": "I would never ______ my children stay out so late.", "options": ["get", "make", "have", "let"], "answer": "D", "explanation": "Risposta: D. 'Let' significa permettere. È simile a un causativo ma esprime permesso, non incarico." },
                { "question": "You should ______ your blood pressure checked regularly.", "options": ["make", "get", "do", "let"], "answer": "B", "explanation": "Risposta: B. La struttura per ricevere un servizio è 'get/have + oggetto + participio passato'." },
                { "question": "We can't fix the printer ourselves. We need to ______ a technician to come and fix it.", "options": ["have", "make", "get", "let"], "answer": "C", "explanation": "Risposta: C. La struttura 'get + persona + infinito con to' è usata per persuadere o incaricare qualcuno a fare qualcosa." },
                { "question": "The comedian was so funny, he ______ the whole audience laughing.", "options": ["got", "had", "made", "let"], "answer": "C", "explanation": "Risposta: C. 'Made' è spesso usato per descrivere una reazione involontaria o un effetto diretto causato da qualcosa o qualcuno. 'He made them laugh' significa che li ha fatti ridere direttamente." },
                { "question": "I can't believe the boss ______ you work on a national holiday! ", "options": ["got", "let", "made", "had"], "answer": "C", "explanation": "Risposta: C. 'Made' è la scelta migliore per esprimere costrizione o obbligo." },
                { "question": "Could you ______ David to bring the documents to the meeting?", "options": ["have", "get", "make", "let"], "answer": "B", "explanation": "Risposta: B. 'Get' + persona + 'to' + verbo è la struttura corretta per chiedere a qualcuno di persuadere un altro." },
                { "question": "I'm ______ a new air conditioning unit installed next week.", "options": ["making", "letting", "getting", "doing"], "answer": "C", "explanation": "Risposta: C. La forma 'am getting' è usata per il causativo al Present Continuous." },
                { "question": "The government will ______ new regulations implemented by the end of the year.", "options": ["get", "have", "make", "let"], "answer": "B", "explanation": "Risposta: B. 'Have' è più formale e adatta a un contesto governativo. La struttura è 'have + oggetto + participio passato'." },
                { "question": "She ______ her hair dyed blue, but her parents were not happy.", "options": ["made", "let", "got", "did"], "answer": "C", "explanation": "Risposta: C. 'Got her hair dyed' è la forma passiva standard." },
                { "question": "Don't ______ him talk you into buying something you don't need.", "options": ["make", "have", "get", "let"], "answer": "D", "explanation": "Risposta: D. 'Don't let him...' significa 'non permettergli di...'." },
                { "question": "The film was so sad it ______ me cry.", "options": ["got", "had", "made", "let"], "answer": "C", "explanation": "Risposta: C. 'Make' è il verbo causativo usato per una reazione emotiva involontaria." },
                { "question": "You need to ______ that strange noise in your car checked out.", "options": ["get", "make", "let", "do"], "answer": "A", "explanation": "Risposta: A. 'Get + oggetto + participio passato' è la structure corretta per un servizio." },
                { "question": "The manager ______ his team stay late to finish the project.", "options": ["got", "let", "had", "allowed"], "answer": "C", "explanation": "Risposta: C. 'Had' è usato per dare un'istruzione. 'Got' richiederebbe 'to stay'." },
                { "question": "I finally ______ my computer to work after restarting it five times.", "options": ["had", "made", "got", "let"], "answer": "C", "explanation": "Risposta: C. Anche se non è una persona, 'get + oggetto + to + verbo' si può usare per descrivere lo sforzo di far funzionare qualcosa." },
                { "question": "I'll ______ the report sent to you by the end of the day.", "options": ["make", "let", "get", "do"], "answer": "C", "explanation": "Risposta: C. 'Get + oggetto + participio passato' è una forma comune per promettere un servizio." },
                { "question": "We must ______ this issue resolved as soon as possible.", "options": ["have", "make", "let", "do"], "answer": "A", "explanation": "Risposta: A. 'Have' è la scelta più formale e adatta per un contesto professionale." },
                { "question": "My parents never ______ me watch TV after 9 PM when I was a kid.", "options": ["got", "made", "let", "had"], "answer": "C", "explanation": "Risposta: C. 'Let' è il verbo per esprimere permesso." }
            ],
            "fase3": [
                { "prompt": "A photographer will take our family portrait.", "question": "We are going to...", "type": "input_rewrite", "answer": "have our family portrait taken", "explanation": "La risposta corretta è \"have our family portrait taken\". La struttura è 'have + oggetto (our family portrait) + participio passato (taken)'." },
                { "prompt": "I'll ask the IT department to install the software for me.", "question": "I will have...", "type": "input_rewrite", "answer": "the IT department install the software", "explanation": "La risposta corretta è \"the IT department install the software\". La struttura è 'have + persona (the IT department) + verbo base (install)'." },
                { "prompt": "Someone cleans her house every week.", "question": "She has...", "type": "input_rewrite", "answer": "her house cleaned every week", "explanation": "La risposta corretta è \"her house cleaned every week\". La struttura è 'has + oggetto (her house) + participio passato (cleaned)'." },
                { "prompt": "I persuaded my brother to lend me his car.", "question": "I got...", "type": "input_rewrite", "answer": "my brother to lend me his car", "explanation": "La risposta corretta è \"my brother to lend me his car\". La struttura è 'got + persona (my brother) + infinito con to (to lend)'." },
                { "prompt": "A technician needs to service the air conditioner.", "question": "We need to have...", "type": "input_rewrite", "answer": "the air conditioner serviced", "explanation": "La risposta corretta è \"the air conditioner serviced\". La struttura è 'have + oggetto (the air conditioner) + participio passato (serviced)'." },
                { "prompt": "The company will hire an external consultant to review the accounts.", "question": "The company will have...", "type": "input_rewrite", "answer": "the accounts reviewed by an external consultant", "explanation": "La risposta corretta è \"the accounts reviewed by an external consultant\". La struttura passiva è 'have + oggetto + participio passato'." },
                { "prompt": "My boss forced me to work on the weekend.", "question": "My boss made...", "type": "input_rewrite", "answer": "me work on the weekend", "explanation": "La risposta corretta è \"me work on the weekend\". La struttura con 'make' per la costrizione è 'make + persona + verbo base'." },
                { "prompt": "I will tell the assistant to send the documents.", "question": "I will have...", "type": "input_rewrite", "answer": "the assistant send the documents", "explanation": "La risposta corretta è \"the assistant send the documents\". La struttura attiva con 'have' per un'istruzione è 'have + persona + verbo base'." },
                { "prompt": "Someone stole their car from the parking lot.", "question": "They had...", "type": "input_rewrite", "answer": "their car stolen from the parking lot", "explanation": "La risposta corretta è \"their car stolen from the parking lot\". Il causativo si usa anche per eventi negativi subiti." },
                { "prompt": "I convinced my team to adopt the new strategy.", "question": "I got...", "type": "input_rewrite", "answer": "my team to adopt the new strategy", "explanation": "La risposta corretta è \"my team to adopt the new strategy\". La struttura con 'get' per la persuasione è 'get + persona + infinito con to'." },
                { "prompt": "The editor will check your article for mistakes.", "question": "You will have...", "type": "input_rewrite", "answer": "your article checked for mistakes", "explanation": "La risposta corretta è \"your article checked for mistakes\". La struttura passiva è 'have + oggetto + participio passato'." },
                { "prompt": "I'll permit you to leave early today.", "question": "I'll let...", "type": "input_rewrite", "answer": "you leave early today", "explanation": "La risposta corretta è \"you leave early today\". La struttura con 'let' per il permesso è 'let + persona + verbo base'." },
                { "prompt": "The government requires that citizens pay taxes.", "question": "The government makes...", "type": "input_rewrite", "answer": "citizens pay taxes", "explanation": "La risposta corretta è \"citizens pay taxes\". 'Make' può essere usato per esprimere un obbligo o una legge." },
                { "prompt": "I'll arrange for a courier to pick up the package.", "question": "I'll get...", "type": "input_rewrite", "answer": "a courier to pick up the package", "explanation": "La risposta corretta è \"a courier to pick up the package\". La struttura con 'get' per un servizio è 'get + persona + infinito con to'." },
                { "prompt": "An expert is tuning the piano right now.", "question": "We are having...", "type": "input_rewrite", "answer": "the piano tuned right now", "explanation": "La risposta corretta è \"the piano tuned right now\". La forma per un'azione in corso è 'are having + oggetto + participio passato'." },
                { "prompt": "The loud music from next door kept me awake all night.", "question": "The loud music from next door made...", "type": "input_rewrite", "answer": "me stay awake all night", "explanation": "La risposta corretta è \"me stay awake all night\". 'Made' è usato per indicare la causa di un'azione o stato." },
                { "prompt": "You should ask someone to translate this for you.", "type": "input_rewrite", "answer": "this translated", "explanation": "La risposta corretta è \"this translated\". La forma passiva 'get + oggetto + participio passato' è la più naturale qui." },
                { "prompt": "The personal trainer instructed me to do 20 push-ups.", "question": "The personal trainer had...", "type": "input_rewrite", "answer": "me do 20 push-ups", "explanation": "La risposta corretta è \"me do 20 push-ups\". 'Had' è usato per un'istruzione diretta." },
                { "prompt": "The dentist is going to remove my wisdom tooth.", "question": "I'm going to have...", "type": "input_rewrite", "answer": "my wisdom tooth removed", "explanation": "La risposta corretta è \"my wisdom tooth removed\". La struttura passiva è 'have + oggetto + participio passato'." },
                { "prompt": "My parents allowed me to choose my own university.", "question": "My parents let...", "type": "input_rewrite", "answer": "me choose my own university", "explanation": "La risposta corretta è \"me choose my own university\". 'Let' è usato per dare il permesso." }
            ]
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const exerciseDataScript = document.getElementById('exercise-data');
            const exerciseData = JSON.parse(exerciseDataScript.textContent);

            let currentActiveTab = 1; // Default to Fase 1

            // Function to save progress (answers)
            const saveProgress = () => {
                const answers = {};
                tabContents.forEach((tabContent, index) => {
                    const phaseNum = index + 1;
                    const inputs = tabContent.querySelectorAll('input[type="radio"], input[type="text"]');
                    inputs.forEach(input => {
                        if (input.type === 'radio' && input.checked) {
                            answers[`fase${phaseNum}_q${input.name}`] = input.value;
                        } else if (input.type === 'text') {
                            answers[`fase${phaseNum}_q${input.id}`] = input.value;
                        }
                    });
                });
                localStorage.setItem('causativoProgress', JSON.stringify(answers)); // Changed key for L2
            };

            // Function to load progress (answers)
            const loadProgress = () => {
                const savedAnswers = JSON.parse(localStorage.getItem('causativoProgress')) || {}; // Changed key for L2
                tabContents.forEach((tabContent, index) => {
                    const phaseNum = index + 1;
                    const inputs = tabContent.querySelectorAll('input[type="radio"], input[type="text"]');
                    inputs.forEach(input => {
                        if (input.type === 'radio' && savedAnswers[`fase${phaseNum}_q${input.name}`] === input.value) {
                            input.checked = true;
                        } else if (input.type === 'text' && savedAnswers[`fase${phaseNum}_q${input.id}`]) {
                            input.value = savedAnswers[`fase${phaseNum}_q${input.id}`];
                        }
                    });
                });
            };

            // Function to render questions for a given phase
            const renderQuestions = (phaseNum) => {
                const contentDiv = document.getElementById(`tab-content-${phaseNum}`);
                contentDiv.innerHTML = ''; // Clear previous content

                const phaseKey = `fase${phaseNum}`;
                const questions = exerciseData[phaseKey];

                if (!questions) {
                    contentDiv.innerHTML = `<p class="text-slate-500">No exercises available for Fase ${phaseNum}.</p>`;
                    return;
                }

                questions.forEach((q, index) => {
                    const questionElement = document.createElement('div');
                    questionElement.className = 'mb-6 p-4 border border-slate-200 rounded-lg bg-white shadow-sm';

                    // Use displayNum if available, otherwise just index + 1
                    const displayNum = q.displayNum ? q.displayNum : `${index + 1}`; // Changed to just index + 1 for simplicity
                    let questionHtml = `<p class="font-semibold text-lg mb-3">${displayNum}. ${q.question}</p>`;

                    if (q.type === 'mc') {
                        q.options.forEach((choice, i) => {
                            const inputId = `fase${phaseNum}-q${index}-${i}`;
                            const value = String.fromCharCode(65 + i); // A, B, C, D
                            questionHtml += `
                                <div class="flex items-center mb-2">
                                    <input type="radio" id="${inputId}" name="q${index}" value="${value}" class="mr-2 text-indigo-600 focus:ring-indigo-500">
                                    <label for="${inputId}" class="text-slate-700">${choice}</label>
                                </div>
                            `;
                        });
                    } else if (q.type === 'input_rewrite') {
                        const inputId = `fase${phaseNum}-q${index}`;
                        questionHtml += `
                            <div class="mt-3">
                                <input type="text" id="${inputId}" class="w-full p-2 border border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" placeholder="Your answer">
                            </div>
                        `;
                    }

                    questionElement.innerHTML = questionHtml;
                    contentDiv.appendChild(questionElement);
                });

                // Add a submit button for each phase
                const submitButton = document.createElement('button');
                submitButton.textContent = 'Check Answers';
                submitButton.className = 'mt-6 px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors duration-300 shadow-md';
                submitButton.onclick = () => checkAnswers(phaseNum);
                contentDiv.appendChild(submitButton);

                // Add a clear answers button
                const clearButton = document.createElement('button');
                clearButton.textContent = 'Clear Answers';
                clearButton.className = 'mt-6 ml-4 px-6 py-3 bg-slate-400 text-white font-bold rounded-lg hover:bg-slate-500 transition-colors duration-300 shadow-md';
                clearButton.onclick = () => clearAnswers(phaseNum);
                contentDiv.appendChild(clearButton);

                loadProgress(); // Load saved answers after rendering questions
            };

            // Function to check answers and provide feedback
            const checkAnswers = (phaseNum) => {
                const contentDiv = document.getElementById(`tab-content-${phaseNum}`);
                const questions = exerciseData[`fase${phaseNum}`];

                questions.forEach((q, index) => {
                    const questionElement = contentDiv.children[index]; // Get the specific question div
                    let isCorrect = false;
                    let userAnswer = '';

                    if (q.type === 'mc') {
                        const selectedInput = questionElement.querySelector(`input[name="q${index}"]:checked`);
                        if (selectedInput) {
                            userAnswer = selectedInput.value;
                            // Corrected logic: Compare the value ('A', 'B', etc.) with the answer from JSON
                            isCorrect = (userAnswer.toUpperCase() === q.answer.toUpperCase());
                        }
                    } else if (q.type === 'input_rewrite') {
                        const inputField = questionElement.querySelector(`#fase${phaseNum}-q${index}`);
                        if (inputField) {
                            userAnswer = inputField.value.trim();
                            // Case-insensitive and whitespace-insensitive comparison
                            isCorrect = (userAnswer.toLowerCase() === q.answer.toLowerCase().trim());
                        }
                    }

                    // Remove previous feedback classes
                    questionElement.classList.remove('feedback-correct', 'feedback-incorrect');

                    // Add new feedback class
                    if (isCorrect) {
                        questionElement.classList.add('feedback-correct');
                    } else {
                        questionElement.classList.add('feedback-incorrect');
                    }

                    // Display explanation
                    let explanationElement = questionElement.querySelector('.explanation');
                    if (!explanationElement) {
                        explanationElement = document.createElement('p');
                        explanationElement.className = 'explanation mt-3 text-sm italic text-slate-600';
                        questionElement.appendChild(explanationElement);
                    }
                    explanationElement.innerHTML = `<strong>Spiegazione:</strong> ${q.explanation}`;
                });
                saveProgress(); // Save answers after checking
            };

            // Function to clear answers for a given phase
            const clearAnswers = (phaseNum) => {
                const contentDiv = document.getElementById(`tab-content-${phaseNum}`);
                const inputs = contentDiv.querySelectorAll('input[type="radio"], input[type="text"]');
                inputs.forEach(input => {
                    if (input.type === 'radio') {
                        input.checked = false;
                    } else if (input.type === 'text') {
                        input.value = '';
                    }
                });

                // Remove feedback classes and explanations
                const questionElements = contentDiv.querySelectorAll('.mb-6');
                questionElements.forEach(qElement => {
                    qElement.classList.remove('feedback-correct', 'feedback-incorrect');
                    const explanationElement = qElement.querySelector('.explanation');
                    if (explanationElement) {
                        explanationElement.remove();
                    }
                });
                saveProgress(); // Clear saved answers
            };


            // Tab switching logic
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabToActivate = parseInt(button.dataset.tab);

                    // Deactivate current tab
                    document.getElementById(`tab-btn-${currentActiveTab}`).classList.remove('tab-active');
                    document.getElementById(`tab-btn-${currentActiveTab}`).classList.add('tab-inactive');
                    document.getElementById(`tab-content-${currentActiveTab}`).classList.add('hidden');

                    // Activate new tab
                    button.classList.remove('tab-inactive');
                    button.classList.add('tab-active');
                    document.getElementById(`tab-content-${tabToActivate}`).classList.remove('hidden');

                    currentActiveTab = tabToActivate;
                    renderQuestions(currentActiveTab); // Render questions for the newly active tab
                });
            });

            // Initial render of the first tab
            renderQuestions(currentActiveTab);
        });
    </script>
</body>
</html>
