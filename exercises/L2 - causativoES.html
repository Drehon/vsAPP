<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esercizi Pratici: La Struttura Causativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* bg-slate-200 */
        }
        .tab-btn {
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .tab-active {
            border-bottom-color: #4f46e5; /* border-indigo-600 */
            color: #3730a3; /* text-indigo-800 */
            font-weight: 600;
        }
        .tab-inactive {
            color: #475569; /* text-slate-600 */
        }
        .feedback-correct {
            color: #166534; /* text-green-800 */
            background-color: #dcfce7; /* bg-green-100 */
            border-left-color: #22c55e; /* border-green-500 */
        }
        .feedback-incorrect {
            color: #991b1b; /* text-red-800 */
            background-color: #fee2e2; /* bg-red-100 */
            border-left-color: #ef4444; /* border-red-500 */
        }
        code, .font-mono {
            font-family: 'Source Code Pro', monospace;
        }
        .notes-content {
            transition: max-height 0.3s ease-in-out;
            max-height: 500px;
            overflow: hidden;
        }
        .notes-content.hidden {
            max-height: 0;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-10 max-w-7xl">

        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
            <header class="p-6 md:p-8">
                <h1 class="text-3xl font-bold text-slate-900">Esercizi Pratici: La Struttura Causativa</h1>
                <p class="text-lg text-slate-600 mt-1">Metti in pratica la teoria con esercizi mirati.</p>
            </header>
            <div class="p-6 border-t border-slate-200 bg-slate-50 text-sm text-slate-600 space-y-3">
                <h3 class="font-semibold text-slate-800">Come usare questa pagina:</h3>
                <ul class="list-disc list-inside space-y-1">
                    <li><strong>Salvataggio Automatico:</strong> I tuoi progressi e le tue note vengono salvati automaticamente nel browser.</li>
                    <li><strong>Area Note:</strong> Usa l'area note sotto ogni domanda per scrivere i tuoi pensieri o dubbi.</li>
                    <li><strong>Carica JSON:</strong> Usa questo pulsante per caricare un file di progressi salvato in precedenza.</li>
                    <li><strong>Salva e Scarica JSON:</strong> Clicca qui per scaricare un file <code>.json</code> con tutte le tue risposte e note.</li>
                    <li><strong>Azzera Test:</strong> Rimuove tutti i progressi salvati nel browser e ripristina gli esercizi.</li>
                </ul>
            </div>
            <div class="px-6 py-4 border-t border-slate-200 bg-slate-100 flex flex-wrap gap-4 justify-center items-center">
                <button id="save-btn" class="text-sm bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-md">Salva e Scarica JSON</button>
                <label class="text-sm bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-md cursor-pointer">
                    <span>Carica JSON</span>
                    <input type="file" id="load-input" class="hidden" accept=".json">
                </label>
                <button id="reset-btn" class="text-sm bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-md">Azzera Test</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- Tabs -->
            <div class="border-b border-slate-200 flex justify-between items-center px-6">
                <nav class="flex flex-wrap sm:flex-nowrap space-x-2 md:space-x-6" aria-label="Tabs">
                    <button data-tab="1" class="tab-btn py-4 px-2 md:px-4 text-sm font-medium tab-active">Fase 1: Comprensione (50)</button>
                    <button data-tab="2" class="tab-btn py-4 px-2 md:px-4 text-sm font-medium tab-inactive">Fase 2: Riconoscimento (30)</button>
                    <button data-tab="3" class="tab-btn py-4 px-2 md:px-4 text-sm font-medium tab-inactive">Fase 3: Produzione (20)</button>
                </nav>
                <div class="flex items-center text-sm">
                    <label for="jump-to" class="text-slate-600 mr-2">Vai a:</label>
                    <input type="number" id="jump-to" class="w-20 border-slate-300 rounded-md shadow-sm text-sm" min="1">
                    <button id="jump-btn" class="ml-2 px-3 py-1 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 text-sm">Vai</button>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="p-6 md:p-8">
                <div id="tab-content-1" class="tab-content space-y-8"></div>
                <div id="tab-content-2" class="tab-content hidden space-y-8"></div>
                <div id="tab-content-3" class="tab-content hidden space-y-8"></div>
            </div>
        </div>
    </div>

    <script id="exercise-data" type="application/json">
        {
            "fase1": [
                { "question": "La frase 'I cut my hair' significa la stessa cosa di 'I had my hair cut'.", "answer": false, "explanation": "Falso. 'I cut my hair' significa che l'ho tagliato io stesso. 'I had my hair cut' significa che un parrucchiere l'ha fatto per me." },
                { "question": "La frase 'She is having her car serviced' significa che sta organizzando affinché un meccanico controlli la sua auto.", "answer": true, "explanation": "Corretto. Lei non sta facendo il servizio, lo sta facendo fare." },
                { "question": "In 'I got the report printed', il verbo 'get' è più formale di 'have'.", "answer": false, "explanation": "Falso. 'Have' è generalmente considerato più formale di 'get' in questa struttura." },
                { "question": "La frase 'He had his assistant call the client' è un esempio di causativo attivo.", "answer": true, "explanation": "Corretto. Specifica chi compie l'azione (his assistant) e usa la struttura 'have + persona + verbo base'." },
                { "question": "La struttura 'get someone to do something' si usa per dare un ordine perentorio.", "answer": false, "explanation": "Falso. Si usa più per 'convincere' o 'persuadere' qualcuno a fare qualcosa." },
                { "question": "'I had my wallet stolen' è un uso corretto della struttura causativa per un evento negativo e non pianificato.", "answer": true, "explanation": "Corretto. La struttura si usa anche per descrivere cose che ci accadono, non solo servizi che richiediamo." },
                { "question": "La frase 'The boss made us work late' ha lo stesso significato di 'The boss had us work late'.", "answer": true, "explanation": "Corretto. Entrambe le frasi indicano che il capo ci ha dato l'istruzione di lavorare fino a tardi." },
                { "question": "Nella frase 'I had the technician fix the computer', 'fix' è un participio passato.", "answer": false, "explanation": "Falso. È un verbo alla forma base. La struttura è 'have + persona + verbo base'." },
                { "question": "Per esprimere persuasione, è più comune usare 'I got my friend to help me' piuttosto che 'I had my friend help me'.", "answer": true, "explanation": "Corretto. 'Get someone to do' implica persuasione, mentre 'have someone do' è più un'istruzione." },
                { "question": "La frase 'We are having a new kitchen installed' è al tempo presente semplice.", "answer": false, "explanation": "Falso. È al Present Continuous, per descrivere un'azione in corso in questo periodo." },
                { "question": "'I'll have my secretary to book a flight' è grammaticalmente corretto.", "answer": false, "explanation": "Falso. Dopo 'have + persona', si usa il verbo base senza 'to'. Corretto: '...have my secretary book...'." },
                { "question": "La struttura causativa si può usare solo per i servizi a pagamento.", "answer": false, "explanation": "Falso. Si può usare per qualsiasi azione che si fa fare a qualcun altro, anche gratuitamente (es. 'I had my brother check my essay')." },
                { "question": "'Get your car washed' è un modo per dare un consiglio o un suggerimento forte.", "answer": true, "explanation": "Corretto. Usato all'imperativo, ha una funzione simile a un suggerimento o un ordine." },
                { "question": "Nella frase 'She got the package delivered', non sappiamo chi ha consegnato il pacco.", "answer": true, "explanation": "Corretto. Il causativo passivo si concentra sull'azione ricevuta, non su chi l'ha eseguita." },
                { "question": "La frase 'He had his car being repaired' è una forma comune e corretta.", "answer": false, "explanation": "Falso. La forma corretta è 'He was having his car repaired' o 'He had his car repaired'. 'being' non si usa in questo modo." },
                { "question": "Il causativo con 'make' ('make someone do something') implica sempre una scelta libera da parte di chi agisce.", "answer": false, "explanation": "Falso. 'Make' implica obbligo o costrizione, non una scelta libera." },
                { "question": "Posso dire 'I will have my house to be painted'.", "answer": false, "explanation": "Falso. La struttura è 'have + oggetto + participio passato'. Corretto: '...have my house painted'." },
                { "question": "La domanda 'Did you have your hair cut?' chiede se hai tagliato i capelli da solo.", "answer": false, "explanation": "Falso. Chiede se sei andato dal parrucchiere, cioè se hai 'fatto tagliare' i capelli." },
                { "question": "La frase 'I must get this suit cleaned' esprime una necessità.", "answer": true, "explanation": "Corretto. La combinazione del modale 'must' con il causativo 'get' esprime un obbligo o una forte necessità." },
                { "question": "'I had him to leave' è una costruzione corretta.", "answer": false, "explanation": "Falso. Con 'have' si usa il verbo base: 'I had him leave'. Con 'get' si userebbe 'to': 'I got him to leave'." },
                { "question": "La frase 'I got my car to be washed' è una forma passiva corretta.", "answer": false, "explanation": "Falso. La forma passiva è 'I got my car washed'. L'infinito non si usa in questa forma." },
                { "question": "La frase 'The film made me cry' è un esempio di causativo.", "answer": true, "explanation": "Corretto. 'Make' è un verbo causativo che indica che qualcosa ha causato una reazione." },
                { "question": "'Let me go' significa 'permettimi di andare'.", "answer": true, "explanation": "Corretto. 'Let' è un verbo causativo che esprime permesso." },
                { "question": "Nella frase 'I had my report checked', 'checked' è un aggettivo.", "answer": false, "explanation": "Falso. È il participio passato del verbo 'check'." },
                { "question": "La frase 'She had her assistant to type the letter' è corretta.", "answer": false, "explanation": "Falso. La struttura è 'have + persona + verbo base (type)'." },
                { "question": "'We got the problem to solve' è una frase corretta.", "answer": false, "explanation": "Falso. La frase corretta sarebbe 'We got the problem solved' (passivo) o 'We got someone to solve the problem' (attivo)." },
                { "question": "La frase 'I will have the package delivered tomorrow' è al futuro.", "answer": true, "explanation": "Corretto. Usa 'will have' per formare il futuro causativo." },
                { "question": "'I'm having a party organized' significa che sto organizzando la festa da solo.", "answer": false, "explanation": "Falso. Significa che qualcun altro (un organizzatore di eventi, amici) la sta organizzando per me." },
                { "question": "La frase 'He got his brother do his homework' è corretta.", "answer": false, "explanation": "Falso. Con 'get' si usa l'infinito con 'to': '...got his brother to do...'" },
                { "question": "'I had my phone repaired' e 'My phone was repaired' hanno esattamente lo stesso significato.", "answer": false, "explanation": "Falso. 'I had my phone repaired' enfatizza che ho organizzato io la riparazione. 'My phone was repaired' è una semplice constatazione passiva." },
                { "question": "'Make' e 'let' sono seguiti dalla forma base del verbo, senza 'to'.", "answer": true, "explanation": "Corretto. Esempi: 'make him go', 'let her see'." },
                { "question": "La forma 'have + oggetto + participio passato' può descrivere un incidente.", "answer": true, "explanation": "Corretto. Esempio: 'She had her leg broken in the accident'." },
                { "question": "La frase 'I'll get it done' è una promessa di fare qualcosa personalmente.", "answer": false, "explanation": "Falso. È una promessa di assicurarsi che l'azione venga completata, probabilmente da qualcun altro." },
                { "question": "Nella struttura attiva, 'get' è più comune di 'have' per dare ordini a subordinati.", "answer": false, "explanation": "Falso. 'Have' (es. 'I had my assistant do it') è più comune per dare istruzioni o ordini in un contesto professionale." },
                { "question": "La frase 'I was made to apologize' è la forma passiva di 'They made me apologize'.", "answer": true, "explanation": "Corretto. Nota che nella forma passiva di 'make', si aggiunge 'to' prima del verbo." },
                { "question": "La frase 'I had my house burgled' è un modo corretto per dire che i ladri sono entrati in casa.", "answer": true, "explanation": "Corretto. È un uso comune del causativo passivo per eventi negativi." },
                { "question": "La frase 'I got my hair cutting' è una forma corretta.", "answer": false, "explanation": "Falso. Si usa il participio passato: 'I got my hair cut'." },
                { "question": "La frase 'I'll have the chef to prepare a special meal' è corretta.", "answer": false, "explanation": "Falso. La struttura è 'have + persona + verbo base': '...have the chef prepare...'" },
                { "question": "Il causativo si usa solo con i verbi 'have', 'get', e 'make'.", "answer": false, "explanation": "Falso. Anche 'let' e 'help' sono considerati verbi causativi ('let me know', 'help me (to) finish')." },
                { "question": "Nella frase 'I helped my dad (to) wash the car', il 'to' è opzionale.", "answer": true, "explanation": "Corretto. Con il verbo 'help', l'infinito che segue può essere usato con o senza 'to'." },
                { "question": "La frase 'I'm going to have my car wash' è corretta.", "answer": false, "explanation": "Falso. Manca il participio passato. Corretto: '...have my car washed'." },
                { "question": "'He had his license suspended' significa che la polizia gli ha sospeso la patente.", "answer": true, "explanation": "Corretto. È un uso passivo per descrivere un'azione subita." },
                { "question": "La frase 'She got her friend buy the tickets' è corretta.", "answer": false, "explanation": "Falso. Con 'get' si usa 'to': '...got her friend to buy...'" },
                { "question": "Un insegnante che dice 'I'll have you all speaking English' sta usando un causativo attivo.", "answer": true, "explanation": "Corretto. Significa 'Farò in modo che tutti voi parliate inglese'." },
                { "question": "La frase 'I had a feeling that something was wrong' è un esempio di causativo.", "answer": false, "explanation": "Falso. Qui 'had' è il verbo principale con il significato di 'avere' o 'provare'." },
                { "question": "La frase 'I had my assistant work on the report' è un esempio di causativo passivo.", "answer": false, "explanation": "Falso. È un esempio di causativo attivo perché specifica chi compie l'azione ('my assistant')." },
                { "question": "La frase 'I got the job' è un esempio di causativo.", "answer": false, "explanation": "Falso. Qui 'got' significa 'ottenere'. Non c'è un'azione fatta fare a qualcun altro." },
                { "question": "La frase 'We had the police investigate the issue' è corretta.", "answer": true, "explanation": "Corretto. È un causativo attivo che usa la struttura 'have + persona/ente + verbo base'." },
                { "question": "La frase 'I let my car to be repaired' è una forma corretta.", "answer": false, "explanation": "Falso. 'Let' non si usa in questo modo. Si direbbe 'I had my car repaired' o 'I let the mechanic repair my car'." },
                { "question": "La frase 'I got myself into trouble' è un esempio di causativo.", "answer": false, "explanation": "Falso. È una frase riflessiva idiomatica, non un causativo nel senso di 'far fare qualcosa'." }
            ],
            "fase2": [
                { "question": "I don't have time to do my own laundry, so I ______ it.", "options": ["get done", "get it done", "do it", "make it do"], "answer": "get it done", "explanation": "La struttura corretta è 'get + oggetto (it) + participio passato (done)'." },
                { "question": "Before the presentation, the CEO had her assistant ______ the final figures.", "options": ["to check", "checking", "check", "checked"], "answer": "check", "explanation": "La struttura del causativo attivo con 'have' è 'have + persona + verbo base'." },
                { "question": "This is a very important document. We must ______ it translated by a professional.", "options": ["have", "do", "get to", "make"], "answer": "have", "explanation": "La struttura è 'have + oggetto + participio passato'." },
                { "question": "It was difficult to convince him, but I finally ______ him to agree.", "options": ["had", "made", "got", "persuaded"], "answer": "got", "explanation": "La struttura per 'convincere/persuadere' è 'get + persona + infinito con to'." },
                { "question": "If you don't understand the contract, you should ______ a lawyer look at it.", "options": ["get", "make", "have", "ask"], "answer": "have", "explanation": "Si usa 'have' per dare un'istruzione o un incarico a un professionista. 'Have a lawyer look'." },
                { "question": "The roof is leaking. We need to ______ repaired before the winter.", "options": ["have it", "it have", "get it to be", "have it get"], "answer": "have it", "explanation": "La struttura è '(to) have + oggetto (it) + participio passato (repaired)'." },
                { "question": "She didn't want to go, but her friends ______ her come to the party.", "options": ["got", "made", "had", "let"], "answer": "made", "explanation": "'Made someone do something' significa 'costringere' o 'forzare'. 'Got' richiederebbe 'to come'." },
                { "question": "I'm going to the dentist to ______ my teeth checked.", "options": ["get", "make", "do", "let"], "answer": "get", "explanation": "La struttura è 'get/have + oggetto + participio passato'." },
                { "question": "The director ______ the marketing team create a new campaign.", "options": ["got", "made", "let", "had"], "answer": "had", "explanation": "'Had' si usa per dare un'istruzione o un incarico. 'Got' richiederebbe 'to create'." },
                { "question": "My computer wasn't working, so I ______ a specialist to fix it.", "options": ["had", "got", "made", "fixed"], "answer": "got", "explanation": "'Got' è usato per persuadere o incaricare qualcuno, e richiede la forma 'get + persona + to + verbo'." },
                { "question": "We had our house ______ last year.", "options": ["renovate", "renovating", "renovated", "to renovate"], "answer": "renovated", "explanation": "Questa è la forma passiva: 'have + oggetto + participio passato'." },
                { "question": "He's very persuasive. He can ______ anyone to do anything.", "options": ["have", "make", "get", "let"], "answer": "get", "explanation": "'Get someone to do something' è la struttura specifica per la persuasione." },
                { "question": "The teacher ______ the students write an extra essay.", "options": ["had", "got", "let", "allowed"], "answer": "had", "explanation": "'Had' implica un'istruzione o un compito assegnato. 'Got' richiederebbe 'to write'." },
                { "question": "I would never ______ my children stay out so late.", "options": ["get", "make", "have", "let"], "answer": "let", "explanation": "'Let' significa permettere. È simile a un causativo ma esprime permesso, non incarico." },
                { "question": "You should ______ your blood pressure checked regularly.", "options": ["make", "get", "do", "let"], "answer": "get", "explanation": "La struttura per ricevere un servizio è 'get/have + oggetto + participio passato'." },
                { "question": "We can't fix the printer ourselves, we need to ______ a technician.", "options": ["get to call", "have call", "get someone to call", "have to call"], "answer": "get someone to call", "explanation": "La frase completa sarebbe 'get a technician to call', ma l'opzione più generica e corretta è 'get someone to call'." },
                { "question": "The comedian was so funny, he ______ the whole audience laughing.", "options": ["got", "had", "made", "let"], "answer": "had", "explanation": "'Had' può essere usato per descrivere un effetto su un gruppo. 'He had them laughing' è idiomatico." },
                { "question": "I can't believe the boss ______ you work on a national holiday!", "options": ["got", "let", "made", "had"], "answer": "made", "explanation": "'Made' è la scelta migliore per esprimere costrizione o obbligo." },
                { "question": "Could you ______ David to bring the documents to the meeting?", "options": ["have", "get", "make", "let"], "answer": "get", "explanation": "'Get' + persona + 'to' + verbo è la struttura corretta per chiedere a qualcuno di persuadere un altro." },
                { "question": "I'm ______ a new air conditioning unit installed next week.", "options": ["making", "letting", "getting", "doing"], "answer": "getting", "explanation": "La forma 'am getting' è usata per il causativo al Present Continuous." },
                { "question": "The government will ______ new regulations implemented by the end of the year.", "options": ["get", "have", "make", "let"], "answer": "have", "explanation": "'Have' è più formale e adatto a un contesto governativo. La struttura è 'have + oggetto + participio passato'." },
                { "question": "She ______ her hair dyed blue, but her parents were not happy.", "options": ["made", "let", "got", "did"], "answer": "got", "explanation": "'Got her hair dyed' è la forma passiva standard." },
                { "question": "Don't ______ him talk you into buying something you don't need.", "options": ["make", "have", "get", "let"], "answer": "let", "explanation": "'Don't let him...' significa 'non permettergli di...'." },
                { "question": "The film was so sad it ______ me cry.", "options": ["got", "had", "made", "let"], "answer": "made", "explanation": "'Make' è il verbo causativo usato per una reazione emotiva involontaria." },
                { "question": "You need to ______ that strange noise in your car checked out.", "options": ["get", "make", "let", "do"], "answer": "get", "explanation": "'Get + oggetto + participio passato' è la struttura corretta per un servizio." },
                { "question": "The manager ______ his team stay late to finish the project.", "options": ["got", "let", "had", "allowed"], "answer": "had", "explanation": "'Had' è usato per dare un'istruzione. 'Got' richiederebbe 'to stay'." },
                { "question": "I finally ______ my computer to work after restarting it five times.", "options": ["had", "made", "got", "let"], "answer": "got", "explanation": "Anche se non è una persona, 'get + oggetto + to + verbo' si può usare per descrivere lo sforzo di far funzionare qualcosa." },
                { "question": "I'll ______ the report sent to you by the end of the day.", "options": ["make", "let", "get", "do"], "answer": "get", "explanation": "'Get + oggetto + participio passato' è una forma comune per promettere un servizio." },
                { "question": "We must ______ this issue resolved as soon as possible.", "options": ["have", "make", "let", "do"], "answer": "have", "explanation": "'Have' è la scelta più formale e adatta per un contesto professionale." },
                { "question": "My parents never ______ me watch TV after 9 PM when I was a kid.", "options": ["got", "made", "let", "had"], "answer": "let", "explanation": "'Let' è il verbo per esprimere permesso." }
            ],
            "fase3": [
                { "prompt": "A photographer will take our family portrait.", "question": "We are going to...", "answer": "have our family portrait taken", "explanation": "La struttura è 'have + oggetto (our family portrait) + participio passato (taken)'." },
                { "prompt": "I'll ask the IT department to install the software for me.", "question": "I will have...", "answer": "the IT department install the software", "explanation": "La struttura è 'have + persona (the IT department) + verbo base (install)'." },
                { "prompt": "Someone cleans her house every week.", "question": "She has...", "answer": "her house cleaned every week", "explanation": "La struttura è 'has + oggetto (her house) + participio passato (cleaned)'." },
                { "prompt": "I persuaded my brother to lend me his car.", "question": "I got...", "answer": "my brother to lend me his car", "explanation": "La struttura è 'got + persona (my brother) + infinito con to (to lend)'." },
                { "prompt": "A technician needs to service the air conditioner.", "question": "We need to have...", "answer": "the air conditioner serviced", "explanation": "La struttura è 'have + oggetto (the air conditioner) + participio passato (serviced)'." },
                { "prompt": "The company will hire an external consultant to review the accounts.", "question": "The company will have...", "answer": "the accounts reviewed by an external consultant", "explanation": "La struttura passiva è 'have + oggetto + participio passato'." },
                { "prompt": "My boss forced me to work on the weekend.", "question": "My boss made...", "answer": "me work on the weekend", "explanation": "La struttura con 'make' per la costrizione è 'make + persona + verbo base'." },
                { "prompt": "I will tell the assistant to send the documents.", "question": "I will have...", "answer": "the assistant send the documents", "explanation": "La struttura attiva con 'have' per un'istruzione è 'have + persona + verbo base'." },
                { "prompt": "Someone stole their car from the parking lot.", "question": "They had...", "answer": "their car stolen from the parking lot", "explanation": "Il causativo si usa anche per eventi negativi subiti." },
                { "prompt": "I convinced my team to adopt the new strategy.", "question": "I got...", "answer": "my team to adopt the new strategy", "explanation": "La struttura con 'get' per la persuasione è 'get + persona + infinito con to'." },
                { "prompt": "The editor will check your article for mistakes.", "question": "You will have...", "answer": "your article checked for mistakes", "explanation": "La struttura passiva è 'have + oggetto + participio passato'." },
                { "prompt": "I'll permit you to leave early today.", "question": "I'll let...", "answer": "you leave early today", "explanation": "La struttura con 'let' per il permesso è 'let + persona + verbo base'." },
                { "prompt": "The government requires that citizens pay taxes.", "question": "The government makes...", "answer": "citizens pay taxes", "explanation": "'Make' può essere usato per esprimere un obbligo o una legge." },
                { "prompt": "I'll arrange for a courier to pick up the package.", "question": "I'll get...", "answer": "a courier to pick up the package", "explanation": "La struttura con 'get' per un servizio è 'get + persona + infinito con to'." },
                { "prompt": "An expert is tuning the piano right now.", "question": "We are having...", "answer": "the piano tuned right now", "explanation": "La forma per un'azione in corso è 'are having + oggetto + participio passato'." },
                { "prompt": "The loud music from next door kept me awake all night.", "question": "The loud music from next door made...", "answer": "me stay awake all night", "explanation": "'Made' è usato per indicare la causa di un'azione o stato." },
                { "prompt": "You should ask someone to translate this for you.", "question": "You should get...", "answer": "this translated", "explanation": "La forma passiva 'get + oggetto + participio passato' è la più naturale qui." },
                { "prompt": "The personal trainer instructed me to do 20 push-ups.", "question": "The personal trainer had...", "answer": "me do 20 push-ups", "explanation": "'Had' è usato per un'istruzione diretta." },
                { "prompt": "The dentist is going to remove my wisdom tooth.", "question": "I'm going to have...", "answer": "my wisdom tooth removed", "explanation": "La struttura passiva è 'have + oggetto + participio passato'." },
                { "prompt": "My parents allowed me to choose my own university.", "question": "My parents let...", "answer": "me choose my own university", "explanation": "'Let' è usato per dare il permesso." }
            ]
        }
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const exerciseData = JSON.parse(document.getElementById('exercise-data').textContent);
        const storageKey = 'causativo-es-state-v3';
        let state = JSON.parse(localStorage.getItem(storageKey)) || { answers: {}, notes: {} };

        function saveState() {
            localStorage.setItem(storageKey, JSON.stringify(state));
        }
        
        function createNotesArea(phase, index) {
            const noteKey = `n_${phase}_${index}`;
            const savedNote = state.notes[noteKey] || '';
            
            return `
                <div class="mt-3">
                    <button class="notes-toggle-btn text-xs text-slate-500 hover:text-indigo-600">Note</button>
                    <div class="notes-content hidden mt-2">
                        <textarea data-note-key="${noteKey}" class="notes-textarea w-full h-20 p-2 text-sm bg-slate-100 border border-slate-200 rounded-md focus:ring-indigo-500 focus:border-indigo-500" placeholder="Scrivi qui le tue note...">${savedNote}</textarea>
                    </div>
                </div>
            `;
        }

        function addNotesListeners(container) {
            container.querySelectorAll('.notes-toggle-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const content = e.target.nextElementSibling;
                    content.classList.toggle('hidden');
                    e.target.textContent = content.classList.contains('hidden') ? 'Note' : 'Nascondi Note';
                });
            });

            container.querySelectorAll('.notes-textarea').forEach(area => {
                area.addEventListener('input', (e) => {
                    state.notes[e.target.dataset.noteKey] = e.target.value;
                    saveState();
                });
            });
        }


        function renderFase1() {
            const container = document.getElementById('tab-content-1');
            container.innerHTML = '';
            exerciseData.fase1.forEach((q, index) => {
                const answerKey = `f1_${index}`;
                const userAnswer = state.answers[answerKey];
                const isAnswered = userAnswer !== undefined;
                const isCorrect = isAnswered && userAnswer === q.answer;

                const questionEl = document.createElement('div');
                questionEl.id = `q-f1-${index}`;
                questionEl.className = 'p-4 border border-slate-200 rounded-lg shadow-sm';
                questionEl.innerHTML = `
                    <p class="text-slate-800">${index + 1}. ${q.question}</p>
                    <div class="flex items-center space-x-4 mt-3">
                        <button data-answer="true" class="f1-btn px-4 py-2 text-sm font-semibold rounded-md transition-colors ${userAnswer === true ? (isCorrect ? 'bg-green-600 text-white' : 'bg-red-600 text-white') : 'bg-slate-200 hover:bg-slate-300'}">Vero</button>
                        <button data-answer="false" class="f1-btn px-4 py-2 text-sm font-semibold rounded-md transition-colors ${userAnswer === false ? (isCorrect ? 'bg-green-600 text-white' : 'bg-red-600 text-white') : 'bg-slate-200 hover:bg-slate-300'}">Falso</button>
                    </div>
                    ${isAnswered ? `<div class="mt-3 p-3 text-sm border-l-4 rounded-r-md ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}">${q.explanation}</div>` : ''}
                    ${createNotesArea(1, index)}
                `;
                container.appendChild(questionEl);

                if (!isAnswered) {
                    questionEl.querySelectorAll('.f1-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            state.answers[answerKey] = btn.dataset.answer === 'true';
                            saveState();
                            renderFase1();
                        });
                    });
                }
            });
            addNotesListeners(container);
        }

        function renderFase2() {
            const container = document.getElementById('tab-content-2');
            container.innerHTML = '';
            exerciseData.fase2.forEach((q, index) => {
                const answerKey = `f2_${index}`;
                const userAnswer = state.answers[answerKey];
                const isAnswered = userAnswer !== undefined;
                const isCorrect = isAnswered && userAnswer === q.answer;

                const optionsHtml = q.options.map(opt => {
                    let btnClass = 'bg-slate-200 hover:bg-slate-300';
                    if (isAnswered) {
                        if (opt === q.answer) {
                            btnClass = 'bg-green-600 text-white';
                        } else if (opt === userAnswer) {
                            btnClass = 'bg-red-600 text-white';
                        }
                    }
                    return `<button data-answer="${opt}" class="f2-btn px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${btnClass}">${opt}</button>`;
                }).join('');

                const questionEl = document.createElement('div');
                questionEl.id = `q-f2-${index}`;
                questionEl.className = 'p-4 border border-slate-200 rounded-lg shadow-sm';
                questionEl.innerHTML = `
                    <p class="text-slate-800">${index + 1}. ${q.question.replace('______', '<span class="font-mono text-indigo-600">______</span>')}</p>
                    <div class="flex flex-wrap items-center gap-3 mt-3">
                        ${optionsHtml}
                    </div>
                    ${isAnswered ? `<div class="mt-3 p-3 text-sm border-l-4 rounded-r-md ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}">${q.explanation}</div>` : ''}
                    ${createNotesArea(2, index)}
                `;
                container.appendChild(questionEl);

                if (!isAnswered) {
                    questionEl.querySelectorAll('.f2-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            state.answers[answerKey] = btn.dataset.answer;
                            saveState();
                            renderFase2();
                        });
                    });
                }
            });
            addNotesListeners(container);
        }
        
        function renderFase3() {
            const container = document.getElementById('tab-content-3');
            container.innerHTML = '';
            exerciseData.fase3.forEach((q, index) => {
                const answerKey = `f3_${index}`;
                const userAnswer = state.answers[answerKey] || '';
                const isAnswered = userAnswer !== '';
                const isCorrect = isAnswered && userAnswer.trim().toLowerCase() === q.answer.toLowerCase();

                const questionEl = document.createElement('div');
                questionEl.id = `q-f3-${index}`;
                questionEl.className = 'p-4 border border-slate-200 rounded-lg shadow-sm';
                questionEl.innerHTML = `
                    <div class="p-4 bg-slate-50 border border-slate-200 rounded-md">
                        <p class="text-sm text-slate-600">Frase originale:</p>
                        <p class="italic text-slate-800">"${q.prompt}"</p>
                    </div>
                    <p class="mt-3 text-slate-800">${index + 1}. ${q.question}</p>
                    <div class="flex items-center space-x-2 mt-2">
                        <input type="text" value="${userAnswer}" class="f3-input flex-grow p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" ${isAnswered ? 'disabled' : ''}>
                        ${!isAnswered ? `<button class="f3-submit-btn px-4 py-2 text-sm font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700">Controlla</button>` : ''}
                    </div>
                    ${isAnswered ? `<div class="mt-3 p-3 text-sm border-l-4 rounded-r-md ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}">
                        ${isCorrect ? '' : `<p class="font-semibold">La tua risposta: <span class="font-mono">${userAnswer}</span></p><p class="mt-1 font-semibold">Risposta corretta: <span class="font-mono">${q.answer}</span></p><hr class="my-2">`}
                        ${q.explanation}
                    </div>` : ''}
                    ${createNotesArea(3, index)}
                `;
                container.appendChild(questionEl);
                
                const input = questionEl.querySelector('.f3-input');
                const submitBtn = questionEl.querySelector('.f3-submit-btn');

                const handleSubmit = () => {
                    if (input.value.trim() === '') return;
                    state.answers[answerKey] = input.value.trim();
                    saveState();
                    renderFase3();
                };

                submitBtn?.addEventListener('click', handleSubmit);
                input?.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') handleSubmit();
                });
            });
            addNotesListeners(container);
        }

        function switchTab(tabNumber) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`tab-content-${tabNumber}`).classList.remove('hidden');

            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.toggle('tab-active', b.dataset.tab == tabNumber);
                b.classList.toggle('tab-inactive', b.dataset.tab != tabNumber);
            });
            
            if (tabNumber == 1) renderFase1();
            if (tabNumber == 2) renderFase2();
            if (tabNumber == 3) renderFase3();
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => switchTab(btn.dataset.tab));
        });

        document.getElementById('save-btn').addEventListener('click', () => {
            const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.download = 'esercizi-causativo-progress.json';
            a.href = url;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        document.getElementById('load-input').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const loadedState = JSON.parse(e.target.result);
                    if (loadedState.answers && loadedState.notes) {
                        state = loadedState;
                        saveState();
                        switchTab('1');
                    } else {
                         alert('Errore: Formato del file non corretto.');
                    }
                } catch (error) {
                    alert('Errore: File JSON non valido.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            if (confirm('Sei sicuro di voler cancellare tutti i progressi e le note?')) {
                state = { answers: {}, notes: {} };
                saveState();
                switchTab('1');
            }
        });

        function addNavigationListeners() {
            const jumpInput = document.getElementById('jump-to');
            const jumpBtn = document.getElementById('jump-btn');

            const jumpToAction = () => {
                const qNum = parseInt(jumpInput.value);
                if (isNaN(qNum)) return;

                const activeTab = document.querySelector('.tab-btn.tab-active').dataset.tab;
                const questions = exerciseData[`fase${activeTab}`];
                if (qNum < 1 || qNum > questions.length) {
                    alert(`Numero non valido. Inserisci un numero tra 1 e ${questions.length}.`);
                    return;
                }

                const questionId = `q-f${activeTab}-${qNum - 1}`;
                const questionEl = document.getElementById(questionId);
                if (questionEl) {
                    questionEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    questionEl.classList.add('ring-2', 'ring-indigo-400', 'ring-offset-2');
                    setTimeout(() => {
                        questionEl.classList.remove('ring-2', 'ring-indigo-400', 'ring-offset-2');
                    }, 2500);
                }
            };

            jumpBtn.addEventListener('click', jumpToAction);
            jumpInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    jumpToAction();
                }
            });
        }

        // Initial render
        switchTab('1');
        addNavigationListeners();
    });
    </script>
</body>
</html>
