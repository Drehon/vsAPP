<div class="content-container p-6 md:p-10" 
     data-page-id="L4ES-grammatica-irreale" 
     data-module="interactive-exercise">

    <!-- 1. Header Section (Standardized) -->
    <header class="content-header bg-white rounded-lg shadow-lg p-6 mb-8">
        <h1 id="page-title" class="text-3xl font-bold text-slate-900">Esercizi Pratici: La Grammatica dell'Irrealtà</h1>
        <p id="page-subtitle" class="text-lg text-slate-600 mt-2">Verifica la tua padronanza del congiuntivo e dei periodi ipotetici complessi.</p>
        <div class="mt-4 pt-4 border-t border-slate-200 bg-slate-50 -m-6 p-6 pb-4 text-sm text-slate-600 space-y-3">
            <h3 class="font-semibold text-slate-800">Come usare questa pagina:</h3>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Salvataggio Automatico:</strong> I tuoi progressi (risposte e note) vengono salvati costantemente.</li>
                <li><strong>Pulsanti di Navigazione:</strong> Utilizza i pulsanti sulla barra degli strumenti per navigare tra le schede, salvare e caricare i progressi o ripristinare l'esercizio.</li>
            </ul>
        </div>
    </header>

    <!-- 2. Main Content Area (to be populated by the hydrator) -->
    <main id="content-body" class="content-body bg-white rounded-lg shadow-lg p-6 md:p-8">
        <!-- The exercise-handler.js will populate this area -->
    </main>

    <!-- 3. Data Island (Standardized) -->
    <script type="application/json" id="page-data">
    {
        "title": "Esercizi Pratici: La Grammatica dell'Irrealtà",
        "subtitle": "Verifica la tua padronanza del congiuntivo e dei periodi ipotetici complessi.",
        "blocks": [
            {
                "name": "Fase 1: Comprensione (Vero/Falso)",
                "exercises": [
                    { "type": "true-false", "question": "La frase 'The manager insists that everyone is on time' è corretta.", "answer": false, "explanation": "Falso. 'Insists' è un verbo 'trigger' che richiede il congiuntivo. La forma corretta è '...that everyone BE on time'." },
                    { "type": "true-false", "question": "La frase 'If I had known, I would have come' è un esempio corretto di terzo condizionale.", "answer": true, "explanation": "Vero. La struttura 'If + Past Perfect, would have + P.P.' è corretta." },
                    { "type": "true-false", "question": "La frase 'It is essential that the report is submitted by Friday' è corretta.", "answer": false, "explanation": "Falso. 'Essential' è un aggettivo 'trigger'. La forma corretta è '...that the report BE submitted'." },
                    { "type": "true-false", "question": "Nel terzo condizionale, la 'if-clause' usa la struttura 'would have + participio passato'.", "answer": false, "explanation": "Falso. La 'if-clause' usa il Past Perfect (had + P.P.). La 'main clause' usa 'would have + P.P.'." },
                    { "type": "true-false", "question": "La frase 'I suggest that he takes a break' è grammaticalmente corretta.", "answer": false, "explanation": "Falso. 'Suggest' richiede il congiuntivo. La forma corretta è '...that he TAKE a break'." },
                    { "type": "true-false", "question": "Il condizionale misto collega una condizione passata a un risultato presente.", "answer": true, "explanation": "Vero. Es: 'If I had studied more, I would have a better job now'." },
                    { "type": "true-false", "question": "La frase 'The board required that the new policy was implemented immediately' è corretta.", "answer": false, "explanation": "Falso. 'Require' è un 'trigger' per il congiuntivo. Corretto: '...that the new policy BE implemented'." },
                    { "type": "true-false", "question": "La frase 'If she had taken the job, she would be rich now' è un esempio di condizionale misto.", "answer": true, "explanation": "Vero. Collega una condizione passata (had taken) a un risultato presente (would be rich now)." },
                    { "type": "true-false", "question": "La frase 'It is important that she understands the rules' è corretta.", "answer": false, "explanation": "Falso. 'Important' richiede il congiuntivo. Corretto: '...that she UNDERSTAND the rules'." },
                    { "type": "true-false", "question": "La frase 'If the team would have played better, they would have won' è corretta.", "answer": false, "explanation": "Falso. Questo è un errore comune. La 'if-clause' non usa 'would have'. Corretto: 'If the team HAD played better...'" },
                    { "type": "true-false", "question": "La frase 'The doctor recommended that he rest for a week' è corretta.", "answer": true, "explanation": "Vero. 'Recommend' è un 'trigger' e 'rest' è la forma base del verbo (congiuntivo)." },
                    { "type": "true-false", "question": "La frase 'We would be less tired now if we had gone to bed earlier last night' è un condizionale misto corretto.", "answer": true, "explanation": "Vero. La struttura 'would + base form' nella 'main clause' e 'if + past perfect' nella 'if-clause' è corretta." },
                    { "type": "true-false", "question": "La frase 'The law demands that all citizens pay taxes' è corretta.", "answer": false, "explanation": "Falso. 'Demands' richiede il congiuntivo. Corretto: '...that all citizens PAY taxes'." },
                    { "type": "true-false", "question": "La frase 'If I would have seen you, I would have said hello' è un modo corretto per esprimere un'ipotesi passata.", "answer": false, "explanation": "Falso. La 'if-clause' deve usare il Past Perfect. Corretto: 'If I HAD seen you...'" },
                    { "type": "true-false", "question": "La frase 'It is vital that the equipment be checked regularly' è corretta.", "answer": true, "explanation": "Vero. 'Vital' è un 'trigger' e 'be' è la forma base richiesta dal congiuntivo." },
                    { "type": "true-false", "question": "Il congiuntivo inglese è complesso e ha molte coniugazioni diverse.", "answer": false, "explanation": "Falso. Il congiuntivo inglese è radicalmente semplice: è sempre la forma base del verbo." },
                    { "type": "true-false", "question": "La frase 'If he hadn't missed the train, he would have been here on time' è corretta.", "answer": true, "explanation": "Vero. È un terzo condizionale strutturato correttamente." },
                    { "type": "true-false", "question": "La frase 'The CEO proposed that the meeting was postponed' è corretta.", "answer": false, "explanation": "Falso. 'Proposed' richiede il congiuntivo. Corretto: '...that the meeting BE postponed'." },
                    { "type": "true-false", "question": "La frase 'I wouldn't be in this mess if I had listened to you' è un esempio di condizionale misto.", "answer": true, "explanation": "Vero. Collega una condizione passata (had listened) a un risultato presente (wouldn't be in this mess)." },
                    { "type": "true-false", "question": "La frase 'It is imperative that he is informed immediately' è corretta.", "answer": false, "explanation": "Falso. 'Imperative' è un 'trigger' per il congiuntivo. Corretto: '...that he BE informed'." },
                    { "type": "true-false", "question": "La frase 'If you had told me about the problem, I could have helped' è corretta.", "answer": true, "explanation": "Vero. 'Could have' può sostituire 'would have' nella 'main clause' del terzo condizionale." },
                    { "type": "true-false", "question": "La frase 'Her parents insisted that she studied medicine' è corretta.", "answer": false, "explanation": "Falso. 'Insisted' richiede il congiuntivo. Corretto: '...that she STUDY medicine'." },
                    { "type": "true-false", "question": "La frase 'If they had invested in that company, they would be millionaires now' è un terzo condizionale.", "answer": false, "explanation": "Falso. È un condizionale misto (condizione passata, risultato presente)." },
                    { "type": "true-false", "question": "La frase 'The judge ordered that the prisoner be released' è corretta.", "answer": true, "explanation": "Vero. 'Ordered' è un 'trigger' e 'be released' è il congiuntivo passivo corretto." },
                    { "type": "true-false", "question": "La frase 'He would have a car now if he would have saved money' è corretta.", "answer": false, "explanation": "Falso. La 'if-clause' è errata. Corretto: '...if he HAD saved money'." },
                    { "type": "true-false", "question": "La frase 'It's desirable that every student has a laptop' è corretta.", "answer": false, "explanation": "Falso. 'Desirable' richiede il congiuntivo. Corretto: '...that every student HAVE a laptop'." },
                    { "type": "true-false", "question": "La frase 'If I were you, I would have accepted the offer' non è un condizionale standard.", "answer": true, "explanation": "Vero. È un condizionale misto che combina il secondo (If I were you) e il terzo (would have accepted) per dare un consiglio su un'azione passata." },
                    { "type": "true-false", "question": "La frase 'The committee requested that the proposal was reviewed again' è corretta.", "answer": false, "explanation": "Falso. 'Requested' richiede il congiuntivo. Corretto: '...that the proposal BE reviewed'." },
                    { "type": "true-false", "question": "La frase 'We might have won the game if our best player hadn't been injured' è corretta.", "answer": true, "explanation": "Vero. 'Might have' può sostituire 'would have' per esprimere una possibilità passata." },
                    { "type": "true-false", "question": "La frase 'It is necessary that he finishes his work' è corretta.", "answer": false, "explanation": "Falso. 'Necessary' richiede il congiuntivo. Corretto: '...that he FINISH his work'." }
                ]
            },
            {
                "name": "Fase 2: Riconoscimento (Scelta Multipla)",
                "exercises": [
                    { "type": "multiple-choice", "question": "The manager demanded that the report ______ on his desk by 5 PM.", "options": ["is", "was", "be", "has been"], "answer": "be", "explanation": "'Demand' è un verbo 'trigger' che richiede il congiuntivo (la forma base 'be')." },
                    { "type": "multiple-choice", "question": "If the company ______ the issue earlier, the crisis would have been averted.", "options": ["had addressed", "would have addressed", "addressed", "has addressed"], "answer": "had addressed", "explanation": "Questa è la 'if-clause' di un terzo condizionale, che richiede il Past Perfect (had + P.P.)." },
                    { "type": "multiple-choice", "question": "It is essential that every employee ______ the new safety procedures.", "options": ["understand", "understands", "understood", "has understood"], "answer": "understand", "explanation": "'Essential' è un aggettivo 'trigger' che richiede il congiuntivo (la forma base 'understand')." },
                    { "type": "multiple-choice", "question": "We wouldn't be in this situation now if we ______ your advice.", "options": ["took", "would have taken", "had taken", "have taken"], "answer": "had taken", "explanation": "Questa è la 'if-clause' di un condizionale misto (risultato presente), che richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "I suggest that she ______ with a specialist before making a decision.", "options": ["consults", "consult", "consulted", "is consulting"], "answer": "consult", "explanation": "'Suggest' è un 'trigger' per il congiuntivo (la forma base 'consult')." },
                    { "type": "multiple-choice", "question": "If I ______ you were coming, I would have baked a cake.", "options": ["would have known", "knew", "had known", "have known"], "answer": "had known", "explanation": "La 'if-clause' del terzo condizionale richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "It is imperative that the government ______ action to solve the problem.", "options": ["takes", "took", "take", "has taken"], "answer": "take", "explanation": "'Imperative' richiede il congiuntivo (la forma base 'take')." },
                    { "type": "multiple-choice", "question": "The project ______ if the main investor hadn't pulled out.", "options": ["would succeed", "would have succeeded", "had succeeded", "succeeded"], "answer": "would have succeeded", "explanation": "Questa è la 'main clause' di un terzo condizionale, che richiede 'would have + P.P.'." },
                    { "type": "multiple-choice", "question": "The board of directors recommended that the CEO ______.", "options": ["resigns", "resigned", "resign", "to resign"], "answer": "resign", "explanation": "'Recommended' richiede il congiuntivo (la forma base 'resign')." },
                    { "type": "multiple-choice", "question": "If he ______ harder for the exam, he wouldn't have to retake it now.", "options": ["studied", "had studied", "would have studied", "has studied"], "answer": "had studied", "explanation": "Questa è la 'if-clause' di un condizionale misto, che richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "It is important that the information ______ confidential.", "options": ["remains", "remain", "remained", "has remained"], "answer": "remain", "explanation": "'Important' richiede il congiuntivo (la forma base 'remain')." },
                    { "type": "multiple-choice", "question": "What would you have done if you ______ in my position?", "options": ["were", "had been", "would have been", "have been"], "answer": "had been", "explanation": "La 'if-clause' del terzo condizionale richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "The law requires that every car ______ a safety inspection each year.", "options": ["undergoes", "undergo", "underwent", "is undergoing"], "answer": "undergo", "explanation": "'Requires' richiede il congiuntivo (la forma base 'undergo')." },
                    { "type": "multiple-choice", "question": "I ______ that presentation now if I had finished it yesterday.", "options": ["wouldn't be giving", "wouldn't have given", "hadn't given", "didn't give"], "answer": "wouldn't be giving", "explanation": "Questa è la 'main clause' di un condizionale misto (risultato presente), che richiede 'would + verbo base'." },
                    { "type": "multiple-choice", "question": "It is vital that the team ______ as one unit.", "options": ["works", "worked", "work", "is working"], "answer": "work", "explanation": "'Vital' richiede il congiuntivo (la forma base 'work')." },
                    { "type": "multiple-choice", "question": "They insisted that he ______ for his mistake.", "options": ["apologize", "apologizes", "apologized", "has apologized"], "answer": "apologize", "explanation": "'Insisted' è un trigger per il congiuntivo (forma base 'apologize')." },
                    { "type": "multiple-choice", "question": "If you ______ me, we wouldn't have gotten lost.", "options": ["listened", "would have listened", "had listened", "have listened"], "answer": "had listened", "explanation": "La if-clause del terzo condizionale richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "The teacher's request was that every student ______ an essay.", "options": ["writes", "write", "wrote", "has written"], "answer": "write", "explanation": "Dopo 'request that', si usa il congiuntivo (forma base 'write')." },
                    { "type": "multiple-choice", "question": "He would be the company director today if he ______ that job offer years ago.", "options": ["had accepted", "accepted", "would have accepted", "has accepted"], "answer": "had accepted", "explanation": "La if-clause di un condizionale misto richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "It is advisable that she ______ some time off.", "options": ["takes", "take", "took", "is taking"], "answer": "take", "explanation": "'Advisable' richiede il congiuntivo (forma base 'take')." },
                    { "type": "multiple-choice", "question": "We could have gone to the beach if it ______.", "options": ["hadn't rained", "didn't rain", "wouldn't have rained", "hasn't rained"], "answer": "hadn't rained", "explanation": "La if-clause del terzo condizionale richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "The contract stipulates that the payment ______ within 30 days.", "options": ["is made", "be made", "was made", "has been made"], "answer": "be made", "explanation": "'Stipulates' richiede il congiuntivo passivo (be + P.P.)." },
                    { "type": "multiple-choice", "question": "If I had known about your allergy, I ______ a different dish.", "options": ["would make", "made", "would have made", "had made"], "answer": "would have made", "explanation": "La main clause del terzo condizionale richiede 'would have + P.P.'." },
                    { "type": "multiple-choice", "question": "His only demand is that his name ______ from the report.", "options": ["is removed", "was removed", "be removed", "has been removed"], "answer": "be removed", "explanation": "Dopo 'demand that', si usa il congiuntivo passivo (be + P.P.)." },
                    { "type": "multiple-choice", "question": "She wouldn't be so stressed now if she ______ procrastinating last week.", "options": ["didn't start", "hadn't started", "wouldn't have started", "hasn't started"], "answer": "hadn't started", "explanation": "La if-clause di un condizionale misto richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "It is crucial that the system ______ before the launch.", "options": ["is tested", "was tested", "be tested", "has been tested"], "answer": "be tested", "explanation": "'Crucial' richiede il congiuntivo passivo (be + P.P.)." },
                    { "type": "multiple-choice", "question": "If the security guard ______ attention, the theft could have been prevented.", "options": ["paid", "had been paying", "had paid", "would have paid"], "answer": "had paid", "explanation": "La if-clause del terzo condizionale richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "The rules require that all participants ______ a helmet.", "options": ["wear", "wears", "wore", "are wearing"], "answer": "wear", "explanation": "'Require' è un trigger per il congiuntivo (forma base 'wear')." },
                    { "type": "multiple-choice", "question": "I might have invested in the company if their business plan ______ more convincing.", "options": ["was", "had been", "would have been", "has been"], "answer": "had been", "explanation": "La if-clause del terzo condizionale richiede il Past Perfect." },
                    { "type": "multiple-choice", "question": "My recommendation is that the company ______ its marketing strategy.", "options": ["revises", "revise", "revised", "is revising"], "answer": "revise", "explanation": "Dopo 'recommendation that', si usa il congiuntivo (forma base 'revise')." }
                ]
            },
            {
                "name": "Fase 3: Produzione (Completa/Riscrivi)",
                "exercises": [
                    { "type": "fill-in-the-blank", "prompt": "The professor insisted that all papers (to be) submitted on time.", "question": "The professor insisted that all papers ______ submitted on time.", "answer": "be", "explanation": "'Insisted' richiede il congiuntivo. La forma base di 'to be' è 'be'." },
                    { "type": "fill-in-the-blank", "prompt": "If we (to know) about the traffic, we would have left earlier.", "question": "If we ______ about the traffic, we would have left earlier.", "answer": "had known", "explanation": "La 'if-clause' del terzo condizionale richiede il Past Perfect (had + P.P.)." },
                    { "type": "fill-in-the-blank", "prompt": "It is vital that he (to tell) the truth immediately.", "question": "It is vital that he ______ the truth immediately.", "answer": "tell", "explanation": "'Vital' richiede il congiuntivo (la forma base 'tell')." },
                    { "type": "fill-in-the-blank", "prompt": "I wouldn't be so tired now if I (to go) to bed earlier last night.", "question": "I wouldn't be so tired now if I ______ to bed earlier last night.", "answer": "had gone", "explanation": "La 'if-clause' di un condizionale misto richiede il Past Perfect." },
                    { "type": "fill-in-the-blank", "prompt": "The client requires that the contract (to be) reviewed by a lawyer.", "question": "The client requires that the contract ______ reviewed by a lawyer.", "answer": "be", "explanation": "'Requires' richiede il congiuntivo passivo (be + P.P.)." },
                    { "type": "rewrite", "prompt": "They didn't repair the road. That's why the accident happened.", "question": "If they ______ the road, the accident ______.", "answer": "had repaired / wouldn't have happened", "explanation": "Trasformazione in un terzo condizionale." },
                    { "type": "rewrite", "prompt": "He should solve the problem. That is my suggestion.", "question": "I suggest that he ______ the problem.", "answer": "solve", "explanation": "Trasformazione usando il congiuntivo dopo 'suggest'." },
                    { "type": "rewrite", "prompt": "She didn't buy the lottery ticket. She isn't rich now.", "question": "If she ______ the lottery ticket, she ______ rich now.", "answer": "had bought / would be", "explanation": "Trasformazione in un condizionale misto." },
                    { "type": "rewrite", "prompt": "All staff must attend the meeting. It's imperative.", "question": "It is imperative that all staff ______ the meeting.", "answer": "attend", "explanation": "Trasformazione usando il congiuntivo dopo 'imperative'." },
                    { "type": "rewrite", "prompt": "I didn't see the warning sign. I fell.", "question": "If I ______ the warning sign, I ______.", "answer": "had seen / wouldn't have fallen", "explanation": "Trasformazione in un terzo condizionale." },
                    { "type": "fill-in-the-blank", "prompt": "The committee recommended that the budget (to be) increased.", "question": "The committee recommended that the budget ______ increased.", "answer": "be", "explanation": "'Recommended' richiede il congiuntivo passivo." },
                    { "type": "fill-in-the-blank", "prompt": "If the alarm (to go off), the police would have arrived sooner.", "question": "If the alarm ______, the police would have arrived sooner.", "answer": "had gone off", "explanation": "La 'if-clause' del terzo condizionale richiede il Past Perfect." },
                    { "type": "fill-in-the-blank", "prompt": "It is essential that the driver (to have) a valid license.", "question": "It is essential that the driver ______ a valid license.", "answer": "have", "explanation": "'Essential' richiede il congiuntivo (la forma base 'have')." },
                    { "type": "fill-in-the-blank", "prompt": "She would speak fluent French now if she (to stay) in Paris longer.", "question": "She would speak fluent French now if she ______ in Paris longer.", "answer": "had stayed", "explanation": "La 'if-clause' di un condizionale misto richiede il Past Perfect." },
                    { "type": "fill-in-the-blank", "prompt": "The judge demanded that the witness (to answer) the question.", "question": "The judge demanded that the witness ______ the question.", "answer": "answer", "explanation": "'Demanded' richiede il congiuntivo (la forma base 'answer')." },
                    { "type": "rewrite", "prompt": "He didn't save money. He can't buy a house now.", "question": "If he ______ money, he ______ a house now.", "answer": "had saved / could buy", "explanation": "Trasformazione in un condizionale misto." },
                    { "type": "rewrite", "prompt": "The documents must be signed. This is a requirement.", "question": "The requirement is that the documents ______.", "answer": "be signed", "explanation": "Trasformazione usando il congiuntivo passivo." },
                    { "type": "rewrite", "prompt": "You didn't tell me the truth. I am angry.", "question": "I wouldn't be angry if you ______ me the truth.", "answer": "had told", "explanation": "Trasformazione in un condizionale misto." },
                    { "type": "rewrite", "prompt": "The team needs to be more focused. The coach insists on it.", "question": "The coach insists that the team ______ more focused.", "answer": "be", "explanation": "Trasformazione usando il congiuntivo dopo 'insists'." },
                    { "type": "rewrite", "prompt": "The system crashed. We lost all the data.", "question": "If the system ______, we ______ all the data.", "answer": "hadn't crashed / wouldn't have lost", "explanation": "Trasformazione in un terzo condizionale." }
                ]
            }
        ]
    }
    </script>
</div>
st